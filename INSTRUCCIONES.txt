================================================================================
INSTRUCCIONES DE USO - PRÃCTICA DE ARBITRAJE EN MERCADOS FINANCIEROS
================================================================================

Rodolfo Villena Lapaz | 14 MIAX | Diciembre 2025

================================================================================
RESUMEN DEL PROYECTO
================================================================================

âœ“ AnÃ¡lisis de arbitraje cross-venue en 4 mercados (BME, CBOE, AQUIS, TURQUOISE)
âœ“ Procesamiento de 64 ISINs espaÃ±oles con datos de alta frecuencia
âœ“ SimulaciÃ³n de latencia realista (14 niveles: 0Î¼s - 100ms)
âœ“ Filtros de calidad avanzados para resultados ejecutables
âœ“ GeneraciÃ³n automÃ¡tica de 7 grÃ¡ficos profesionales (300 DPI)
âœ“ AnÃ¡lisis completo de pares de venues y direccionalidad

RESULTADOS CLAVE:
â€¢ 1.034 oportunidades Ãºnicas detectadas
â€¢ â‚¬1.184,11 beneficio total teÃ³rico (latencia 0)
â€¢ Decay crÃ­tico: 42% a 10ms de latencia
â€¢ Top pair: CBOEâ†”BME (â‚¬473,03 combinado)

================================================================================
ARCHIVOS DEL PROYECTO
================================================================================
ARCHIVOS PRINCIPALES:
---------------------
â€¢ PracticaRV.py          â†’ Script principal (EJECUTAR ESTE)
â€¢ utilities.py           â†’ Funciones auxiliares optimizadas (NO MODIFICAR)
â€¢ requirements.txt       â†’ Dependencias Python
â€¢ README.md             â†’ DocumentaciÃ³n completa actualizada
â€¢ Informe_arbitraje_BME.md â†’ Informe tÃ©cnico detallado

SCRIPTS AUXILIARES:
-------------------
â€¢ run_all_isins.py      â†’ Script para ejecutar con todos los ISINs
â€¢ test_practica.py      â†’ Script de pruebas unitarias
â€¢ Working with microsecond timeseries.ipynb â†’ Notebook anÃ¡lisis exploratorio

DOCUMENTACIÃ“N:
--------------
â€¢ INSTRUCCIONES.txt     â†’ Este archivo (guÃ­a rÃ¡pida)
â€¢ money_table.csv       â†’ Resultados de latencia (generado)
â€¢ venue_pairs_analysis.csv â†’ AnÃ¡lisis de pares (generado)

================================================================================
INSTALACIÃ“N (SOLO LA PRIMERA VEZ)
================================================================================

1ï¸âƒ£ CREAR ENTORNO VIRTUAL:
   python -m venv .venv

2ï¸âƒ£ ACTIVAR ENTORNO VIRTUAL:
   Windows:  .venv\Scripts\activate
   Linux/Mac: source .venv/bin/activate

3ï¸âƒ£ INSTALAR DEPENDENCIAS:
   pip install -r requirements.txt

4ï¸âƒ£ (OPCIONAL) INSTALAR NUMBA PARA MEJOR RENDIMIENTO:
   pip install numba>=0.57.0
   âš¡ Puede reducir tiempos hasta un 30%

âœ… VERIFICACIÃ“N:
   python PracticaRV.py --help  # DeberÃ­a mostrar mensaje de uso

================================================================================
EJECUCIÃ“N - ELIGE TU OPCIÃ“N
================================================================================

ğŸš€ OPCIÃ“N 1: EJECUCIÃ“N RÃPIDA (5 ISINs - 40 segundos)
-------------------------------------------------------
   python PracticaRV.py

   âœ… Procesa 5 ISINs principales espaÃ±oles:
   â€¢ Banco Santander (ES0113900J37)
   â€¢ Inditex (ES0113211835)
   â€¢ TelefÃ³nica (ES0144580Y14)
   â€¢ Iberdrola (ES0178430E18)
   â€¢ BBVA (ES0113679I37)

   ğŸ“Š Genera resultados preliminares y todos los grÃ¡ficos

ğŸ”¥ OPCIÃ“N 2: EJECUCIÃ“N COMPLETA (64 ISINs - 8-10 minutos)
---------------------------------------------------------
   MÃ©todo A - Script auxiliar (RECOMENDADO):
      python run_all_isins.py

   MÃ©todo B - EdiciÃ³n manual:
      1. Abrir PracticaRV.py
      2. LÃ­nea 33: cambiar USE_ALL_ISINS = False â†’ USE_ALL_ISINS = True
      3. Guardar y ejecutar: python PracticaRV.py

   ğŸ¯ Procesa TODOS los ISINs disponibles en las 4 venues
   ğŸ“ˆ Genera anÃ¡lisis completo con resultados definitivos

================================================================================
ARCHIVOS GENERADOS
================================================================================

DespuÃ©s de ejecutar, se generarÃ¡n:

ğŸ“„ TABLAS CSV GENERADAS:
-----------------------
1ï¸âƒ£ money_table.csv
   â†’ Profit por ISIN y nivel de latencia
   â†’ Formato: Filas = ISINs, Columnas = Latencias
   â†’ Incluye totales y estadÃ­sticas de decay

2ï¸âƒ£ venue_pairs_analysis.csv
   â†’ AnÃ¡lisis detallado de pares de venues
   â†’ Columnas: sell_venue, buy_venue, direction, opportunities
   â†’ total_profit, avg_profit, avg_spread, avg_quantity
   â†’ Formato direccional: Aâ†’B = vender en A, comprar en B

ğŸ¨ GRÃFICOS PNG (300 DPI - ALTA CALIDAD):
--------------------------------------
3ï¸âƒ£ decay_chart_total.png
   â†’ GrÃ¡fico principal: profit total vs latencia
   â†’ Incluye estadÃ­sticas de decay y lÃ­neas verticales clave

4ï¸âƒ£ decay_chart_by_isin.png
   â†’ Profit por ISIN vs latencia (Top 10 mÃ¡s rentables)
   â†’ Colores diferenciados por ISIN para fÃ¡cil comparaciÃ³n

5ï¸âƒ£ profit_distribution.png
   â†’ Histogramas de distribuciÃ³n de profits
   â†’ Tres paneles: 0Î¼s, 1ms, 10ms con media y mediana

6ï¸âƒ£ venue_pairs_heatmap.png
   â†’ Dos heatmaps lado a lado:
     â€¢ Izquierda: Total Profit por par de venues (â‚¬)
     â€¢ Derecha: NÃºmero de Oportunidades por par
   â†’ Filas = Venue de venta, Columnas = Venue de compra

7ï¸âƒ£ venue_pairs_top10.png
   â†’ Dos grÃ¡ficos de barras horizontales:
     â€¢ Superior: Top 10 pares mÃ¡s rentables
     â€¢ Inferior: Top 10 pares con mÃ¡s oportunidades
   â†’ Formato direccional con valores exactos

================================================================================
âš™ï¸ CONFIGURACIÃ“N AVANZADA
================================================================================

ParÃ¡metros modificables en PracticaRV.py:

ğŸ¯ USE_ALL_ISINS (lÃ­nea 33)
   False = Solo 5 ISINs seleccionados (rÃ¡pido)
   True  = Todos los ISINs disponibles (64 - completo)

ğŸ“Š MAX_ISINS_TO_PLOT (lÃ­nea 45)
   NÃºmero mÃ¡ximo de ISINs en grÃ¡ficos individuales
   Por defecto: 10 (evita saturaciÃ³n visual)

âš¡ LATENCY_LEVELS (lÃ­nea 54)
   Niveles de latencia a simular en microsegundos
   Por defecto: [0, 100, 500, 1000, 2000, 3000, 4000, 5000, 
                 10000, 15000, 20000, 30000, 50000, 100000]

ğŸ“ DATA_FOLDER (lÃ­nea 58)
   Carpeta con los datos de mercado
   Por defecto: 'DATA_BIG'

ğŸ” ENABLE_QUALITY_FILTERS (lÃ­nea 73)
   True  = Activar filtros de calidad (recomendado)
   False = Desactivar para anÃ¡lisis acadÃ©mico

ğŸ›ï¸ FILTER_CONFIG (lÃ­nea 76-82)
   ParÃ¡metros de filtros de calidad:
   â€¢ min_duration_ms: 5.0     (duraciÃ³n mÃ­nima razonable)
   â€¢ max_duration_ms: 60000.0 (mÃ¡ximo para stale quotes)
   â€¢ max_spread_eur: 50.0      (spread mÃ¡ximo razonable)
   â€¢ min_tradable_qty: 5       (mÃ­nimo aceptable de shares)
   â€¢ depth_100_qty_max: 3      (anomalÃ­a de profundidad)

================================================================================
â±ï¸ TIEMPOS DE EJECUCIÃ“N ESTIMADOS
================================================================================

Hardware de referencia: CPU moderna, 8GB RAM

ğŸ“Š Tiempos SIN numba:
â€¢ 5 ISINs:    ~40 segundos
â€¢ 10 ISINs:   ~1.5 minutos
â€¢ 30 ISINs:   ~4 minutos
â€¢ 64 ISINs:   ~8-10 minutos

ğŸš€ Tiempos CON numba (instalado):
â€¢ 5 ISINs:    ~30 segundos (-25%)
â€¢ 10 ISINs:   ~1 minuto   (-33%)
â€¢ 30 ISINs:   ~3 minutos  (-25%)
â€¢ 64 ISINs:   ~6-7 minutos (-30%)

ğŸ’¡ CONSEJOS DE RENDIMIENTO:
â€¢ Cierra aplicaciones pesadas antes de ejecutar
â€¢ Usa SSD para los datos (mejora I/O)
â€¢ Considera numba si ejecutas frecuentemente
â€¢ La versiÃ³n rÃ¡pida (5 ISINs) es ideal para pruebas

================================================================================
ğŸ”§ TROUBLESHOOTING - SOLUCIÃ“N DE PROBLEMAS
================================================================================

âŒ ERROR: "No module named 'pandas'"
âœ… SOLUCIÃ“N: pip install -r requirements.txt

âŒ ERROR: "DATA_BIG folder not found"
âœ… SOLUCIÃ“N: AsegÃºrate que DATA_BIG estÃ¡ en el mismo directorio

âŒ ERROR: "MemoryError" o "Out of memory"
âœ… SOLUCIÃ“N: 
   â€¢ Reduce ISINs procesados (usa modo rÃ¡pido)
   â€¢ Cierra otras aplicaciones
   â€¢ Aumenta RAM virtual si es posible

âŒ ERROR: "El script se queda colgado en Step 4"
âœ… ESTO ES NORMAL: Step 4 (Latency Simulation) es intensivo
   â€¢ Con 64 ISINs puede tardar 5+ minutos
   â€¢ Verifica que utilities.py tiene versiÃ³n optimizada
   â€¢ Monitorea uso de CPU/memoria

âŒ ERROR: "Permission denied" al escribir archivos
âœ… SOLUCIÃ“N: Ejecuta como administrador o cambia carpeta

âŒ ERROR: "ImportError: No module named 'utilities'"
âœ… SOLUCIÃ“N: AsegÃºrate que utilities.py estÃ¡ en el mismo directorio

================================================================================
ğŸ“Š INTERPRETACIÃ“N DE RESULTADOS
================================================================================

ğŸ’° MONEY TABLE (money_table.csv):
--------------------------------
â€¢ Muestra el profit realizado a cada nivel de latencia
â€¢ Busca el "decay" (decaimiento) del profit con latencia creciente
â€¢ Un decay alto indica que las oportunidades son muy breves
â€¢ Decay crÃ­tico: 42% a 10ms (muy sensible a latencia)

ğŸ† TOP 5 ISINs:
---------------
â€¢ ISINs mÃ¡s rentables a latencia 0
â€¢ "Unique Trades" = nÃºmero de oportunidades detectadas
â€¢ "Avg Profit/Trade" = profit promedio por oportunidad
â€¢ Santander e Inditex suelen dominar los resultados

ğŸ”„ VENUE PAIRS ANALYSIS (venue_pairs_analysis.csv):
---------------------------------------------------
â€¢ Formato direccional: Aâ†’B significa "vender en A, comprar en B"
â€¢ Columnas clave:
  â€“ opportunities: NÃºmero de veces que aparece ese par
  â€“ total_profit: Suma de profits de ese par
  â€“ avg_profit: Profit promedio por oportunidad
  â€“ avg_spread: Diferencia de precio media
  â€“ avg_quantity: Volumen disponible medio

ğŸ¯ INTERPRETACIÃ“N DE PARES:
---------------------------
â€¢ Si CBOEâ†’BME tiene mÃ¡s profit que BMEâ†’CBOE:
  â†’ CBOE tiende a tener mejores precios de venta (bid)
  â†’ BME tiende a tener mejores precios de compra (ask)
â€¢ Pares con mÃ¡s oportunidades = mayor desincronizaciÃ³n
â€¢ Ãštil para optimizar estrategias de routing de Ã³rdenes

âœ… SANITY CHECK:
----------------
â€¢ âœ“ = Resultados razonables y ejecutables
â€¢ âš  = Posible anomalÃ­a en los datos (investigar)

ğŸ“ˆ GRÃFICOS GENERADOS:
---------------------
â€¢ decay_chart_total.png: Muestra cÃ³mo decae el profit total
â€¢ decay_chart_by_isin.png: Compara el decay entre ISINs
â€¢ profit_distribution.png: Muestra la distribuciÃ³n estadÃ­stica
â€¢ venue_pairs_heatmap.png: Matrices de profit y oportunidades
  â€“ Filas = Venue de venta (max bid)
  â€“ Columnas = Venue de compra (min ask)
  â€“ Diagonal = Siempre 0 (no se puede arbitrar en mismo venue)
â€¢ venue_pairs_top10.png: Rankings de pares mÃ¡s rentables

================================================================================
ğŸ“ PARA LA ENTREGA FINAL
================================================================================

ğŸ“‹ PASO 1: EJECUTAR ANÃLISIS COMPLETO
------------------------------------
   python run_all_isins.py
   â³ Esto tomarÃ¡ 8-10 minutos y generarÃ¡ todos los resultados

ğŸ“ PASO 2: ARCHIVOS A ENTREGAR
-----------------------------

CÃ“DIGO FUENTE:
-------------
âœ“ PracticaRV.py              (cÃ³digo principal)
âœ“ utilities.py               (funciones auxiliares)
âœ“ requirements.txt           (dependencias)

RESULTADOS:
-----------
âœ“ money_table.csv            (resultados de latencia)
âœ“ venue_pairs_analysis.csv  (anÃ¡lisis de pares)
âœ“ decay_chart_total.png     (grÃ¡fico principal)
âœ“ decay_chart_by_isin.png   (grÃ¡fico por ISIN)
âœ“ profit_distribution.png  (distribuciÃ³n estadÃ­stica)
âœ“ venue_pairs_heatmap.png   (matrices de pares)
âœ“ venue_pairs_top10.png     (rankings de pares)

DOCUMENTACIÃ“N:
--------------
âœ“ README.md                  (guÃ­a completa)
âœ“ INSTRUCCIONES.txt          (esta guÃ­a)
âœ“ Informe_arbitraje_BME.md  (informe tÃ©cnico)

ğŸ“ PASO 3: CONTENIDO DEL INFORME
-------------------------------

1ï¸âƒ£ MONEY TABLE COMPLETA
   â€¢ Todos los ISINs y niveles de latencia
   â€¢ EstadÃ­sticas de decay y anÃ¡lisis

2ï¸âƒ£ IMPACTO DE FILTROS DE CALIDAD
   â€¢ ComparaciÃ³n con/sin filtros (57% reducciÃ³n)
   â€¢ JustificaciÃ³n de parÃ¡metros elegidos
   â€¢ InterpretaciÃ³n de oportunidades eliminadas

3ï¸âƒ£ ANÃLISIS DE PARES DE VENUES
   â€¢ Top 10 pares mÃ¡s rentables (CBOEâ†”BME dominante)
   â€¢ AnÃ¡lisis de direccionalidad y patrones
   â€¢ Implicaciones para estrategias de trading

4ï¸âƒ£ GRÃFICOS GENERADOS
   â€¢ AnÃ¡lisis detallado de cada visualizaciÃ³n
   â€¢ InterpretaciÃ³n de patrones y tendencias

5ï¸âƒ£ ANÃLISIS DECAY DE PROFIT
   â€¢ Decay crÃ­tico: 42% a 10ms
   â€¢ Importancia de HFT y baja latencia
   â€¢ ComparaciÃ³n entre ISINs

6ï¸âƒ£ TOP 5 ISINs MÃS RENTABLES
   â€¢ MÃ©tricas detalladas por ISIN
   â€¢ AnÃ¡lisis de concentraciÃ³n de beneficios

7ï¸âƒ£ CONCLUSIONES ESTRATÃ‰GICAS
   â€¢ Importancia crÃ­tica de la baja latencia
   â€¢ Impacto de calidad de datos en resultados
   â€¢ Pares Ã³ptimos: CBOE-BME como principal
   â€¢ Direccionalidad del arbitraje
   â€¢ Estrategias de routing recomendadas
   â€¢ Diferencia teÃ³rico vs. ejecutable

================================================================================
ğŸ“ˆ EJEMPLO DE RESULTADOS (64 ISINs - COMPLETO)
================================================================================

ğŸ’° MONEY TABLE (RESUMEN):
-------------------------
                ISIN            Name       0Î¼s     1000Î¼s    10000Î¼s
    ES0113900J37 Banco Santander   â‚¬450.25    â‚¬425.50    â‚¬260.75
    ES0113211835         Inditex   â‚¬380.15    â‚¬360.20    â‚¬220.40
    ES0144580Y14      TelefÃ³nica   â‚¬150.30    â‚¬142.80     â‚¬87.15
    ES0178430E18       Iberdrola   â‚¬120.45    â‚¬114.20     â‚¬69.80
    ES0113679I37            BBVA    â‚¬83.96     â‚¬79.80     â‚¬48.60
           TOTAL       All ISINs â‚¬1.184.11  â‚¬1.122.50    â‚¬686.70

ğŸ“‰ DECAY ANALYSIS:
-----------------
â€¢ Decay a 1ms: 5.2% (de â‚¬1.184 a â‚¬1.123)
â€¢ Decay a 10ms: 42.0% (de â‚¬1.184 a â‚¬687)
ğŸ¯ CONCLUSIÃ“N: La latencia es CRÃTICA en arbitraje HFT

ğŸ† TOP 5 PARES DE VENUES MÃS RENTABLES:
---------------------------------------
1. CBOEâ†’BME:     â‚¬250.03 (111 oportunidades, â‚¬2.25/opp)
2. BMEâ†’CBOE:     â‚¬223.00 (59 oportunidades, â‚¬3.78/opp)  
3. AQUISâ†’BME:    â‚¬82.86 (92 oportunidades, â‚¬0.90/opp)
4. BMEâ†’AQUIS:    â‚¬62.66 (85 oportunidades, â‚¬0.74/opp)
5. TURQUOISEâ†’BME: â‚¬36.68 (49 oportunidades, â‚¬0.75/opp)

ğŸ” INSIGHTS CLAVE:
-----------------
â€¢ BME-CBOE es el par mÃ¡s activo (bidireccional)
â€¢ CBOEâ†’BME tiene casi el doble de oportunidades que BMEâ†’CBOE
â€¢ BME aparece frecuentemente como venue de compra (min ask)
â€¢ TURQUOISE tiene menos actividad pero oportunidades rentables

ğŸ’¡ INTERPRETACIÃ“N PRÃCTICA:
---------------------------
Si eres MARKET MAKER:
â†’ Coloca bids agresivos en CBOE (venue de venta frecuente)
â†’ Coloca asks agresivos en BME (venue de compra frecuente)
â†’ Monitorea CBOEâ†’BME como par prioritario

Si optimizas ROUTING:
â†’ Prioriza CBOE para Ã³rdenes de venta
â†’ Prioriza BME para Ã³rdenes de compra
â†’ Considera AQUIS como alternativa secundaria
â†’ Evita TURQUOISE para arbitraje de alta frecuencia

================================================================================
ğŸ¯ CONCLUSIONES FINALES
================================================================================

âœ… El arbitraje cross-venue en mercados espaÃ±oles es REAL y rentable
âœ… La latencia es el factor CRÃTICO (42% decay a 10ms)
âœ… Los filtros de calidad son ESENCIALES para resultados realistas
âœ… CBOE-BME es el par dominante para estrategias HFT
âœ… La direccionalidad del arbitraje proporciona ventajas estratÃ©gicas

ğŸš€ Para trading institucional: enfÃ³cate en CBOEâ†’BME con latencia < 1ms
ğŸ“Š Para anÃ¡lisis acadÃ©mico: estudia patrones de desincronizaciÃ³n
ğŸ’° Para implementaciÃ³n: considera infraestructura de baja latencia

================================================================================
Â© 2025 Rodolfo Villena Lapaz - 14 MIAX
    AnÃ¡lisis realizado para "IntroducciÃ³n a los Sistemas Financieros"
================================================================================
